# 미래의 사용자 경험(UX): 계정 추상화(AA)

## 📜 들어가며: 이더리움 계정의 두 종류와 그 한계

이더리움에는 두 가지 종류의 계정이 있습니다.

1.  **외부 소유 계정 (EOA, Externally Owned Account)**
    -   **정의**: 우리가 흔히 사용하는 개인 지갑 계정입니다. 개인키(Private Key)에 의해 제어됩니다.
    -   **특징**:
        -   개인키를 분실하면 모든 자산을 잃게 됩니다.
        -   모든 트랜잭션을 직접 서명해야 하며, 가스비(수수료)는 반드시 ETH로 지불해야 합니다.
        -   여러 개의 서명이 필요한 다중 서명(Multi-sig) 지갑이나, 특정 조건에 따라 자금 집행을 자동화하는 등의 복잡한 로직을 구현할 수 없습니다.
2.  **컨트랙트 계정 (CA, Contract Account)**
    -   **정의**: 블록체인 상에 배포된 스마트 컨트랙트의 주소입니다. 개인키가 없으며, 내부에 프로그래밍된 코드 로직에 의해서만 제어됩니다.
    -   **특징**:
        -   자체적으로 트랜잭션을 시작할 수 없습니다. 항상 EOA의 호출을 받아야만 동작합니다.
        -   다양한 로직(다중 서명, 소셜 복구 등)을 구현할 수 있지만, 가스비 지불과 같은 기본적인 지갑 기능이 제한적입니다.

이러한 이원화된 구조는 블록체인 대중화에 큰 걸림돌이 되어 왔습니다. 사용자들은 어려운 **시드 구문(Seed Phrase)** 을 안전하게 보관해야 하는 부담을 안고, DApp 개발자들은 복잡한 가스비 문제를 해결하기 위해 별도의 시스템을 만들어야 했습니다.

---

## 🧐 계정 추상화 (Account Abstraction, AA)란?

**계정 추상화(AA)** 는 이러한 문제를 해결하기 위한 혁신적인 개념입니다. 핵심 아이디어는 **"모든 계정을 스마트 컨트랙트처럼 프로그래밍 가능하게 만들자"** 는 것입니다.

즉, EOA와 CA의 경계를 허물고, 사용자의 지갑 자체를 **'스마트 컨트랙트 지갑(Smart Contract Wallet)'** 으로 업그레이드하여 다음과 같은 유연성을 부여하는 것을 목표로 합니다.

-   **서명 방식의 유연성**: 기존의 타원곡선 암호(ECDSA) 방식 외에, 스마트폰의 생체 인증(Face ID, 지문)이나 여러 명의 서명을 요구하는 다중 서명 등 다양한 인증 방식을 도입할 수 있습니다.
-   **가스비 지불의 유연성**: 사용자가 ETH가 없어도, DApp 프로젝트가 대신 가스비를 지불해주거나(Gas Sponsorship), 사용자가 보유한 다른 ERC-20 토큰(예: USDC)으로 가스비를 낼 수 있습니다.
-   **계정 관리의 유연성**: 키 분실 시, 사전에 지정해 둔 '수호자(Guardians)'의 동의를 통해 계정을 복구하는 **소셜 복구(Social Recovery)** 기능을 구현할 수 있습니다.

---

## ERC-4337: 컨센서스 변경 없이 구현하는 계정 추상화

계정 추상화를 이더리움 코어 프로토콜에 직접 도입하는 것은 복잡하고 어려운 일이었습니다. 이를 해결하기 위해 비탈릭 부테린이 제안한 것이 바로 **ERC-4337**입니다.

ERC-4337은 이더리움의 핵심 로직을 변경하지 않고, 기존의 P2P 통신 레이어 위에 **별도의 트랜잭션 처리 시스템**을 추가하여 계정 추상화를 구현하는 표준입니다.

### **ERC-4337의 주요 구성 요소**

1.  **UserOperation**:
    -   사용자가 실제로 원하는 작업을 담은 객체입니다. (예: "A에게 1 ETH를 보내라")
    -   기존의 트랜잭션과 유사하지만, 서명 방식이나 가스비 지불 방식 등을 자유롭게 정의할 수 있습니다.
2.  **스마트 컨트랙트 지갑 (Smart Contract Wallet)**:
    -   ERC-4337 표준을 따르는 사용자의 지갑입니다. 모든 지갑이 스마트 컨트랙트이며, `validateUserOp`와 같은 핵심 함수를 구현해야 합니다.
    -   이 함수는 수신된 `UserOperation`이 유효한지(예: 서명이 올바른지) 검증하는 로직을 담고 있습니다.
3.  **번들러 (Bundler)**:
    -   사용자들이 보낸 여러 개의 `UserOperation`을 모아 하나의 '묶음(Bundle)'으로 만듭니다.
    -   이 묶음을 일반적인 이더리움 트랜잭션에 담아 **엔트리포인트 컨트랙트**로 전송하는 역할을 합니다. 번들러는 이 과정에서 발생하는 가스비를 대신 지불하고, 나중에 사용자나 페이마스터로부터 수수료를 회수합니다.
4.  **엔트리포인트 컨트랙트 (EntryPoint Contract)**:
    -   ERC-4337 시스템의 핵심 관문 역할을 하는 단일 스마트 컨트랙트입니다.
    -   번들러가 보낸 `UserOperation` 묶음을 받아, 각 `UserOperation`에 명시된 스마트 컨트랙트 지갑의 `validateUserOp` 함수를 호출하여 유효성을 검증하고, 검증이 통과되면 실제 작업을 실행시킵니다.
5.  **페이마스터 (Paymaster)**:
    -   선택적으로 사용되는 스마트 컨트랙트로, 사용자를 대신하여 가스비를 지불하는 로직을 담고 있습니다.
    -   DApp 프로젝트는 페이마스터를 통해 "신규 사용자의 첫 5회 트랜잭션 수수료는 우리가 부담한다"와 같은 정책을 구현하거나, 사용자가 USDC와 같은 특정 토큰으로 수수료를 낼 수 있도록 허용할 수 있습니다.

### **ERC-4337 동작 흐름**

1.  **사용자**: 스마트 컨트랙트 지갑을 통해 `UserOperation`을 생성하고, 이를 번들러에게 전송합니다.
2.  **번들러**: 여러 개의 `UserOperation`을 모아 하나의 트랜잭션으로 묶어 엔트리포인트 컨트랙트에 제출합니다.
3.  **엔트리포인트 컨트랙트**:
    -   각 `UserOperation`에 대해 해당 스마트 컨트랙트 지갑의 유효성 검증 함수를 호출합니다.
    -   (페이마스터가 있다면) 페이마스터에게 가스비 대납을 요청합니다.
    -   검증이 완료되면 `UserOperation`에 담긴 실제 작업을 실행합니다.
    -   번들러에게 지출된 가스비를 보상해줍니다.

---

## 계정 추상화가 가져올 미래

계정 추상화는 블록체인 기술을 인터넷 뱅킹이나 핀테크 앱처럼 쉽고 편리하게 만들어 줄 잠재력을 가지고 있습니다.

-   **사용자 친화적인 로그인**: 더 이상 복잡한 시드 구문을 외울 필요 없이, Face ID나 이메일/비밀번호 조합으로 지갑에 접근할 수 있습니다.
-   **키 분실 걱정 해소**: 소셜 복구 기능을 통해 친구나 가족의 도움으로 안전하게 계정을 되찾을 수 있습니다.
-   **가스비 경험 개선**: DApp을 사용할 때마다 가스비를 ETH로 지불하는 대신, 신용카드로 결제하거나 DApp이 제공하는 포인트를 사용하는 등 다양한 결제 방식이 가능해집니다.
-   **다양한 자동화 기능**: "매달 1일에 특정 주소로 100 USDC를 자동 이체" 하거나, "특정 게임 아이템의 가격이 일정 수준 이하로 떨어지면 자동으로 구매"하는 등의 복잡한 금융 및 게임 로직을 지갑 자체에 내장할 수 있습니다.

이처럼 계정 추상화는 Web3 서비스의 사용자 경험(UX)을 획기적으로 개선하여, 블록체인 기술이 진정으로 대중에게 다가갈 수 있는 중요한 발판이 될 것입니다.
